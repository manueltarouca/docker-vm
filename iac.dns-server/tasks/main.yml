---
- name: Make sure data folder exists
  file:
    path: /root/data/coredns/
    state: directory

- name: Copy configuration files
  copy:
    dest: /root/data/coredns/
    src: "{{ item }}"
  loop:
    - Corefile
    - db.192.168.80
    - db.iac.estgv
    - docker-compose.yml
    
- name: Pull coredns/coredns docker image
  docker_image:
    name: coredns/coredns
    tag: latest
    source: pull
    state: present

- name: Disable systemd-resolved service
  service:
    name: systemd-resolved
    enabled: no
    state: stopped

- name: Start docker-compose.yml definition
  docker_compose:
    project_name: coredns
    project_src: /root/data/coredns/